# #ErrorHandling in MVVM

ğŸ”– **ì¶œì²˜: https://benoitpasquier.com/error-handling-swift-mvvm/**<br/>
(ErrorHandlingì„ ì–´ë–»ê²Œ í•˜ë©´ ì¢‹ì„ê¹Œ ê³ ë¯¼í•˜ë©° ê³µë¶€í–ˆë‹¤. ì´ ê¸€ì€ ê±°ì˜ ìœ„ì˜ í¬ìŠ¤íŠ¸ì˜ ë²ˆì—­ ìˆ˜ì¤€..? ì´ë ‡ê²Œ ì ìš©í•´ë³¼ ì˜ˆì •ì´ë‹¤.)


ğŸ™‹ Errorë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œ?


1. Closure as parameter: ViewControllerì—ì„œ ì²˜ë¦¬í•˜ê¸°(feat. completion handler)

   ```swift
   // in CurrencyViewController
   self.viewModel.fetchCurrencies { result in
       switch result {
       case .failure(let error): // Display here
       case .success(_):         // Nothing to do
       }
   }
   ```

   ë¬¸ì œì : viewModelê³¼ ViewController ëª¨ë‘ì—ì„œ ì—ëŸ¬ ì²˜ë¦¬ì— ëŒ€í•œ switch caseë¥¼ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.

   ê°ê°ì˜ ì—­í• ì— ëŒ€í•œ ë…ë¦½ì„±ì„ ì¶”êµ¬í•˜ê³ , ì˜ì¡´ì„±ì„ ì¤„ì´ëŠ” MVVMì˜ ëª©ì ì— ë¶€í•©í•˜ì§€ ì•Šì•„ ë³´ì¸ë‹¤.

2. Dynamic value

   ë·° ëª¨ë¸ì˜ error stateë¥¼ ë·°ì—ì„œ ë°”ì¸ë“œí•˜ëŠ” ë°©ë²•

   ë³´í†µ ë°ì´í„°ì˜ ë³€ê²½ ì²˜ë¦¬ì— ëŒ€í•´ì„œ ì´ë ‡ê²Œ í•˜ëŠ”ë°, ì˜¤ë¥˜ê°€ ìˆì„ ë•Œì—ë„ ì´ë ‡ê²Œ í•˜ëŠ”ê±´ ì–´ë–¨ê¹Œ?

   ```swift
   struct CurrencyViewModel {
       var error : DynamicValue<ErrorResult?> = DynamicValue<ErrorResult?>(nil)
   
       func fetchCurrencies(_ completion: ((Result<Bool, ErrorResult>) -> Void)? = nil) {
       ... // later in the code
   
                   switch result {
                   case .success(let converter) :
                       // reload data
                       self.dataSource?.data.value = converter.rates
                   case .failure(let error) :
                       self.error.value = error
                   }
       }
   }
   
   class CurrencyViewController: UIViewController {
   
       override func viewDidLoad() {
           super.viewDidLoad()
           ...
           self.viewModel.error.addObserver(self) { error in
               // display error
           }
           self.viewModel.fetchCurrencies()
       }
   }
   ```

   ğŸ‘‰ fetchCurrenciesì—ì„œ errorê°€ ë°œìƒí•˜ë©´, `error: DynamicValue<ErrorResult?>`ì— ë„£ì–´ì¤€ë‹¤!

   â€‹	ë·°ì»¨ì—ì„œ addObserverë¥¼ ë‹¬ì•„ì£¼ë©´ api ì˜¤ë¥˜ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ `//display error`ì— ì‘ì„±í•œ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤.

â€‹		â—ï¸í•˜ì§€ë§Œ ì—¬ê¸°ì—ë„ ë¬¸ì œê°€ ìˆëŠ”ë° ìš°ë¦¬ê°€ **ì—ëŸ¬ë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ì—†ë‹¤**ëŠ” ê²ƒì´ë‹¤. ì–¼ë§ˆë‚˜ ë§ì€ ì—ëŸ¬ê°€ ë°œìƒí•  ì§€ ëª¨ë¥¸ë‹¤.



3. ë‹¤ì‹œ ëŒì•„ì˜¨ Closure as property

   ```swift
   struct CurrencyViewModel {
       var onErrorHandling : ((ErrorResult) -> Void)?
   
       func fetchCurrencies(_ completion: ((Result<Bool, ErrorResult>) -> Void)? = nil) {
       ... // later in the code
   
                   switch result {
                   case .success(let converter) :
                       // reload data
                       self.dataSource?.data.value = converter.rates
                   case .failure(let error) :
                       self.onErrorHandling?(error)
                   }
       }
   }
   
   class CurrencyViewController: UIViewController {
   
       override func viewDidLoad() {
           super.viewDidLoad()
           ...
           self.viewModel.onErrorHandling = { error in
               // display error
           }
           self.viewModel.fetchCurrencies()
       }
   }
   ```

   ğŸ‘‰ í´ë¡œì € `onErrorHandling`: ErrorResultë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ”ë‹¤.

   â€‹	  apiì—ì„œ errorê°€ ë°œìƒí–ˆì„ ë•Œ, onErrorHandlingì— ì „ë‹¬í•´ ì£¼ê³ ,

   â€‹	  ViewControllerì—ì„œ ì—ëŸ¬ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í•œë‹¤. <- ì²˜ìŒì´ë‘ ë­ê°€ ë‹¤ë¥´ì§€?!

   ```swift
   // in CurrencyViewController
   self.viewModel.fetchCurrencies { result in
       switch result {
       case .failure(let error): // Display here
       case .success(_):         // Nothing to do
       }
   }
   ```

   - ìœ„ì˜ ì½”ë“œëŠ” ê²°ê³¼ ê°’ì„ ê·¸ëŒ€ë¡œ ë°›ì•„ì™€ì„œ, ì„±ê³µ í–ˆì„ ë•Œë‘ ì‹¤íŒ¨í–ˆì„ ë•Œì˜ caseë¥¼ ëª¨ë‘ ì ì–´ì£¼ì–´ì•¼ í–ˆë‹¤.

   â€‹	 

   onErrorHandlingì„ ì´ìš©í•œ ì—ëŸ¬ ëŒ€ì²˜ëŠ”, íŠ¸ë¦¬ê±°ê°€ ë°œìƒí–ˆì„ ë•Œ ë·°ë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

   ë§Œì•½ì— ì–´ë–¤ ì—ëŸ¬ì— ëŒ€í•´ì„œ ìœ ì €ì—ê²Œ ë³´ì—¬ì§€ëŠ” í™”ë©´ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ë©´, í´ë¡œì €ì— ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´ ëœë‹¤.

   (Observerë¥¼ ì‚¬ìš©í–ˆì„ ë•Œì—ëŠ” íŠ¹ì • ì—ëŸ¬ì— ëŒ€í•œ ì»¨íŠ¸ë¡¤ì„ í•  ìˆ˜ ì—†ì—ˆë‹¤. We canâ€™t really do that with the previous one because we donâ€™t know what other class is observing the value. <- ..?)
